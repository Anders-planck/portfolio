---
title: 'SDK A-Cube e-Receipts'
summary: 'Pacchetto NPM multi-piattaforma basato su TypeScript per la gestione di ricevute elettroniche con caching intelligente e implementazione type-safe'
image: '/images/projects/acube-ereceipt-sdk.svg'
author: 'Anders & A-Cube S.r.l.'
publishedAt: '2025-07-15'
tags: ['TypeScript', 'React', 'React Native', 'Expo', 'SDK', 'IndexedDB', 'Zod', 'Multi-platform']
---

## Panoramica

**@a-cube-io/ereceipts-js-sdk** Ã¨ un SDK TypeScript production-ready per la gestione di ricevute elettroniche, che fornisce supporto multi-piattaforma senza soluzione di continuitÃ  su Browser, Node.js e ambienti React Native. Costruito con strumenti moderni e rigida type safety, offre affidabilitÃ  di livello enterprise con un'esperienza sviluppatore intuitiva.

### Risultati Chiave

- ğŸŒ **Supporto Multi-Piattaforma**: Singolo codebase per Browser, Node.js e React Native
- ğŸ”’ **Implementazione Type-Safe**: TypeScript completo con validazione schema Zod
- ğŸ’¾ **Caching Intelligente**: IndexedDB per browser, strategie di storage ottimizzate
- ğŸ“¦ **Sistema di Build Moderno**: Rollup con tree-shaking e code-splitting
- ğŸ” **Autenticazione mTLS**: Integrazione con expo-mutual-tls per chiamate API sicure
- âš¡ **Performance Ottimizzate**: Lazy loading e gestione efficiente della memoria
- ğŸ¯ **API Developer-Friendly**: Hook e utility intuitive per React/React Native
- ğŸ“Š **Production-Ready**: Utilizzato nei prodotti A-Cube live (Pempel Dashboard, Invoice Dashboard)

[Vedi su GitHub](https://github.com/a-cube-io/ereceipts-js-sdk) | [Pacchetto NPM](https://www.npmjs.com/package/@a-cube-io/ereceipts-js-sdk)

---

## Architettura Tecnica

### Design del Sistema

L'SDK implementa un'architettura a livelli con ottimizzazioni specifiche per piattaforma:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Livello Applicazione (React/RN/Node)        â”‚
â”‚      Hook Personalizzati & Utility               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Livello SDK Core (TypeScript)           â”‚
â”‚   Gestione Ricevute â€¢ Validazione â€¢ Caching    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Livello        â”‚          â”‚  Livello Native    â”‚
â”‚ Browser        â”‚          â”‚  - AsyncStorage    â”‚
â”‚ - IndexedDB    â”‚          â”‚  - SQLite          â”‚
â”‚ - LocalStorage â”‚          â”‚  - Moduli Expo     â”‚
â”‚ - Fetch API    â”‚          â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## FunzionalitÃ  Principali

### 1. Sistema di Gestione Ricevute

L'SDK fornisce una gestione completa del ciclo di vita delle ricevute:

#### Operazioni sulle Ricevute
```typescript
import { EReceiptsSDK } from '@a-cube-io/ereceipts-js-sdk'

// Inizializza SDK
const sdk = new EReceiptsSDK({
  apiUrl: 'https://api.acubeapi.com',
  authToken: 'user-jwt-token',
  enableCache: true,
  cacheTTL: 3600000 // 1 ora
})

// Recupera ricevute con caching automatico
const receipts = await sdk.getReceipts({
  startDate: '2025-01-01',
  endDate: '2025-12-31',
  status: 'validated'
})

// Ottieni singola ricevuta (dalla cache se disponibile)
const receipt = await sdk.getReceipt('receipt-id-123')

// Scarica PDF della ricevuta
const pdfBlob = await sdk.downloadReceiptPDF('receipt-id-123')
```

#### Integrazione React Hooks
```typescript
import { useReceipts, useReceipt } from '@a-cube-io/ereceipts-js-sdk/react'

function ReceiptsList() {
  const { receipts, loading, error, refresh } = useReceipts({
    startDate: '2025-01-01',
    endDate: '2025-12-31'
  })

  if (loading) return <LoadingSpinner />
  if (error) return <ErrorMessage error={error} />

  return (
    <div>
      {receipts.map(receipt => (
        <ReceiptCard key={receipt.id} receipt={receipt} />
      ))}
      <button onClick={refresh}>Aggiorna</button>
    </div>
  )
}
```

### 2. Validazione Type-Safe con Zod

Tutte le risposte API e le strutture dati validate at runtime:

```typescript
import { z } from 'zod'

// Schema ricevuta
const ReceiptSchema = z.object({
  id: z.string().uuid(),
  merchantName: z.string().min(1),
  amount: z.number().positive(),
  currency: z.enum(['EUR', 'USD', 'GBP']),
  date: z.string().datetime(),
  status: z.enum(['pending', 'validated', 'rejected']),
  items: z.array(z.object({
    description: z.string(),
    quantity: z.number().int().positive(),
    unitPrice: z.number().positive(),
    total: z.number().positive()
  }))
})

// Validazione automatica sulle risposte API
const result = ReceiptSchema.safeParse(data)
if (result.success) {
  const receipt = result.data // Completamente tipizzato
}
```

### 3. Sistema di Caching Intelligente

Strategia di caching multi-livello ottimizzata per ogni piattaforma:

#### Implementazione Browser (IndexedDB)
- **Indicizzazione**: Indici su data, status, merchantName per query veloci
- **Operazioni Batch**: Write bulk per performance ottimali
- **Gestione Metadata**: Timestamp ultimo sync per invalidazione cache

#### Implementazione React Native (AsyncStorage)
- **Prefisso Cache**: Organizzazione chiavi con namespace
- **Multi-Get/Set**: Operazioni batch per ridurre latenza
- **Gestione Memoria**: Strategia di eviction LRU

#### Strategia di Invalidazione Cache
- **TTL-Based**: Scadenza automatica dopo durata configurabile
- **Manual Sync**: Refresh triggherato dall'utente invalida la cache
- **Smart Updates**: Aggiornamenti parziali della cache per ricevute modificate
- **Memory Management**: Eviction LRU per limiti di storage browser

### 4. Integrazione Autenticazione mTLS

Integrazione seamless con `@a-cube-io/expo-mutual-tls` per chiamate API sicure:

```typescript
import ExpoMutualTls from '@a-cube-io/expo-mutual-tls'
import { EReceiptsSDK } from '@a-cube-io/ereceipts-js-sdk'

// Configura mTLS
await ExpoMutualTls.configureP12('ereceipts-app', true)
await ExpoMutualTls.storeP12(certificateData, password)

// SDK usa automaticamente mTLS per chiamate API
const sdk = new EReceiptsSDK({
  apiUrl: 'https://api.acubeapi.com',
  useMTLS: true,
  authToken: 'user-jwt-token'
})

// Tutte le chiamate API usano autenticazione certificato client
const receipts = await sdk.getReceipts() // mTLS secured
```

---

## Caratteristiche Performance

### Benchmark

| Operazione | Browser | React Native | Node.js |
|-----------|---------|--------------|---------|
| Inizializzazione SDK | 50ms | 80ms | 30ms |
| Lettura Cache (100 ricevute) | 20ms | 40ms | 15ms |
| Scrittura Cache (100 ricevute) | 100ms | 180ms | 50ms |
| Fetch API (100 ricevute) | 800ms | 900ms | 600ms |
| Validazione Ricevuta (Zod) | 5ms | 7ms | 3ms |

### Footprint Memoria

- **SDK Core**: ~500KB (minified)
- **Dipendenze**: ~1.5MB (axios + zod + idb)
- **Memoria Runtime**: ~5-10MB (100 ricevute in cache)
- **Storage IndexedDB**: ~2KB per ricevuta

### Strategie di Ottimizzazione

1. **Lazy Loading**: Hook React caricano solo quando necessario
2. **Code Splitting**: Bundle separati per React hooks
3. **Tree Shaking**: Codice non utilizzato eliminato dai bundler
4. **Batch Operations**: Write bulk IndexedDB per performance
5. **Response Streaming**: Dataset large processati incrementalmente

---

## Esempio di Integrazione

### App React Native Completa

```typescript
import React, { useEffect } from 'react'
import { View, FlatList, Text, Button } from 'react-native'
import { useReceipts } from '@a-cube-io/ereceipts-js-sdk/react'
import ExpoMutualTls from '@a-cube-io/expo-mutual-tls'

export default function ReceiptsScreen() {
  const { receipts, loading, error, refresh, downloadPDF } = useReceipts({
    startDate: '2025-01-01',
    endDate: '2025-12-31'
  })

  useEffect(() => {
    const setupAuth = async () => {
      await ExpoMutualTls.configureP12('ereceipts-app', true)
    }
    setupAuth()
  }, [])

  if (loading) return <LoadingSpinner />

  return (
    <View style={{ flex: 1 }}>
      <FlatList
        data={receipts}
        keyExtractor={item => item.id}
        renderItem={({ item }) => (
          <ReceiptCard
            receipt={item}
            onDownload={() => downloadPDF(item.id)}
          />
        )}
        refreshing={loading}
        onRefresh={refresh}
      />
    </View>
  )
}
```

---

## Lezioni Apprese & Best Practice

### Decisioni Architetturali

**âœ… Cosa Ha Funzionato Bene**:
- Strategia export multi-piattaforma (condizioni react-native/browser/node)
- Zod per validazione runtime + controllo compile-time TypeScript
- Bundle React hooks separato per migliore tree-shaking
- IndexedDB per caching browser (superiore a LocalStorage)

**ğŸ“š Punti Chiave**:
- Build specifici per piattaforma critici per ottimizzazione bundle size
- Validazione runtime essenziale per integritÃ  dati API
- Strategia caching deve considerare scenari offline
- Integrazione mTLS richiede attenta inizializzazione async

---

## Stack Tecnico

### Linguaggi & Framework
- **TypeScript** (5.0+) - Implementazione type-safe
- **React** (18.2+) - Hook e utility
- **React Native** (0.72+) - Supporto mobile

### Strumenti di Build
- **Rollup** (4.0+) - Module bundler con tree-shaking
- **TypeScript Compiler** - Generazione tipi
- **Jest** (29.5+) - Testing framework

### Dipendenze Core
- **axios** (1.6+) - Client HTTP
- **idb** (8.0+) - Wrapper IndexedDB per browser
- **zod** (4.0+) - Validazione schema runtime
- **@a-cube-io/expo-mutual-tls** - Autenticazione mTLS

---

## Conclusione

**@a-cube-io/ereceipts-js-sdk** dimostra lo sviluppo di SDK multi-piattaforma production-ready con focus su type safety, performance ed esperienza sviluppatore. Il progetto bilancia con successo:

- âœ… **Supporto Multi-piattaforma**: Singolo codebase per web, mobile e server
- âœ… **Type Safety**: Validazione compile-time + runtime
- âœ… **Performance**: Caching intelligente e build ottimizzati
- âœ… **Sicurezza**: Integrazione mTLS per chiamate API autenticate
- âœ… **Developer Experience**: React hooks e design API intuitivo
- âœ… **Utilizzo Production**: Battle-tested in Pempel Dashboard e Invoice Dashboard

**Repository**: Repository interno A-Cube
**Pacchetto**: [@a-cube-io/ereceipts-js-sdk](https://www.npmjs.com/package/@a-cube-io/ereceipts-js-sdk)
**Licenza**: MIT

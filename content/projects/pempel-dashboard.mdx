---
title: 'Pempel Dashboard'
summary: 'Mobile E-Receipt management application built with Expo and React Native, featuring offline support and mTLS authentication'
image: '/images/projects/pempel-dashboard.png'
author: 'Anders & A-Cube S.r.l.'
publishedAt: '2025-07-15'
tags: ['Expo', 'React Native', 'TypeScript', 'Zustand', 'i18next', 'Mobile', 'E-Receipts']
---

## Overview

**Pempel Dashboard** is a production-ready mobile application for managing electronic receipts, built on Expo 53 and React Native 0.79. It provides a seamless offline-first experience with secure mTLS authentication, comprehensive internationalization, and enterprise-grade code quality standards.

### Key Achievements

- 📱 **Modern Expo Stack**: Expo 53, React Native 0.79, Expo Router for file-based navigation
- 🔐 **Secure Authentication**: mTLS client certificate authentication via expo-mutual-tls
- 💾 **Offline-First Architecture**: IndexedDB caching with intelligent sync strategies
- 🌍 **Full Internationalization**: i18next with comprehensive multi-language support
- 📊 **State Management**: Zustand for lightweight, scalable state handling
- ⚡ **Performance Optimized**: FlashList, React Table virtualization, optimized renders
- 🛡️ **Code Quality**: Comprehensive ESLint rules, Prettier, TypeScript strict mode
- 🔄 **Git Hooks**: Husky + lint-staged for pre-commit quality checks

---

## Technical Architecture

### System Design

```
┌──────────────────────────────────────────────────┐
│            Expo Router (File-based)               │
│        app/(tabs)/* • app/modal/*                 │
└────────────────┬─────────────────────────────────┘
                 │
┌────────────────▼─────────────────────────────────┐
│          State Layer (Zustand)                    │
│   Receipts • Auth • UI • Sync • Settings         │
└──────┬──────────────────────────────┬────────────┘
       │                              │
┌──────▼─────────┐          ┌─────────▼────────────┐
│ Data Layer     │          │  Security Layer      │
│ - E-Receipt SDK│          │  - expo-mutual-tls   │
│ - SQLite       │          │  - Secure Store      │
│ - AsyncStorage │          │  - Keychain/Keystore │
└────────────────┘          └──────────────────────┘
```

### Core Technologies

**Expo Ecosystem**:
- **Expo 53**: Latest Expo SDK with modern features
- **Expo Router 5.1**: File-based routing with layouts and navigation
- **Expo SQLite**: Local database for offline receipt storage
- **Expo Secure Store**: Encrypted credential storage
- **Expo File System**: Receipt PDF caching
- **Expo Haptics**: Tactile feedback for better UX

**React Native Stack**:
- **React 19**: Latest React features and optimizations
- **React Native 0.79**: Modern React Native with Fabric renderer
- **React Hook Form**: Performant form validation
- **Lucide React Native**: Consistent iconography

**State & Data Management**:
- **Zustand**: Minimal boilerplate state management
- **@a-cube-io/ereceipts-js-sdk**: Receipt data operations
- **i18next + react-i18next**: Internationalization framework

---

## Core Features

### 1. Receipt Management

**Receipt List** with virtualization:
```typescript
import { FlashList } from '@shopify/flash-list'
import { useReceiptsStore } from '@/store/receipts'

export default function ReceiptsScreen() {
  const { receipts, loading, fetchReceipts } = useReceiptsStore()

  return (
    <FlashList
      data={receipts}
      estimatedItemSize={120}
      renderItem={({ item }) => <ReceiptCard receipt={item} />}
      onRefresh={fetchReceipts}
      refreshing={loading}
    />
  )
}
```

**Receipt Details** with PDF viewing:
```typescript
import { useLocalSearchParams } from 'expo-router'
import { useReceipt } from '@/hooks/useReceipt'
import * as FileSystem from 'expo-file-system'
import * as Sharing from 'expo-sharing'

export default function ReceiptDetails() {
  const { id } = useLocalSearchParams()
  const { receipt, downloadPDF } = useReceipt(id as string)

  const handleShare = async () => {
    const pdfUri = await downloadPDF()
    await Sharing.shareAsync(pdfUri)
  }

  return (
    <View>
      <ReceiptHeader receipt={receipt} />
      <ReceiptItems items={receipt.items} />
      <Button onPress={handleShare}>Share PDF</Button>
    </View>
  )
}
```

### 2. mTLS Authentication Flow

**Certificate Setup**:
```typescript
import ExpoMutualTls from '@a-cube-io/expo-mutual-tls'
import * as SecureStore from 'expo-secure-store'

export const setupMTLS = async (credentials: Credentials) => {
  try {
    // Configure mTLS module
    await ExpoMutualTls.configureP12('pempel-app', true)

    // Store certificate securely
    const certificateData = await fetchUserCertificate(credentials)
    await ExpoMutualTls.storeP12(
      certificateData.p12Base64,
      certificateData.password
    )

    // Store metadata in secure storage
    await SecureStore.setItemAsync('cert_expiry', certificateData.expiryDate)
    await SecureStore.setItemAsync('user_id', credentials.userId)

    return { success: true }
  } catch (error) {
    console.error('mTLS setup failed:', error)
    return { success: false, error }
  }
}
```

**Authenticated API Calls**:
```typescript
import { EReceiptsSDK } from '@a-cube-io/ereceipts-js-sdk'

// SDK automatically uses mTLS for all requests
export const receiptsSDK = new EReceiptsSDK({
  apiUrl: process.env.EXPO_PUBLIC_API_URL,
  useMTLS: true,
  timeout: 30000
})

// All API calls are mTLS authenticated
export const fetchUserReceipts = async (filters) => {
  return await receiptsSDK.getReceipts(filters)
}
```

### 3. Offline-First Data Sync

**Sync Strategy**:
```typescript
import { useSyncStore } from '@/store/sync'
import NetInfo from '@react-native-community/netinfo'

export const useSyncManager = () => {
  const { lastSync, isSyncing, setLastSync } = useSyncStore()

  const syncReceipts = async () => {
    const netInfo = await NetInfo.fetch()

    if (!netInfo.isConnected) {
      return { success: false, reason: 'offline' }
    }

    setIsSyncing(true)

    try {
      // Fetch latest receipts from server
      const serverReceipts = await receiptsSDK.getReceipts({
        since: lastSync
      })

      // Update local cache
      await db.receipts.bulkPut(serverReceipts)

      // Upload pending changes
      const pendingChanges = await db.pendingChanges.toArray()
      for (const change of pendingChanges) {
        await uploadChange(change)
        await db.pendingChanges.delete(change.id)
      }

      setLastSync(new Date())
      return { success: true }
    } catch (error) {
      console.error('Sync failed:', error)
      return { success: false, error }
    } finally {
      setIsSyncing(false)
    }
  }

  return { syncReceipts, lastSync, isSyncing }
}
```

### 4. Internationalization

**Translation Setup**:
```typescript
import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'
import * as Localization from 'expo-localization'

i18n
  .use(initReactI18next)
  .init({
    compatibilityJSON: 'v3',
    resources: {
      en: { translation: require('./locales/en.json') },
      it: { translation: require('./locales/it.json') },
      fr: { translation: require('./locales/fr.json') }
    },
    lng: Localization.locale.split('-')[0],
    fallbackLng: 'en',
    interpolation: { escapeValue: false }
  })
```

**Usage in Components**:
```typescript
import { useTranslation } from 'react-i18next'

export default function ReceiptsList() {
  const { t } = useTranslation()

  return (
    <View>
      <Text>{t('receipts.title')}</Text>
      <Text>{t('receipts.emptyState')}</Text>
      <Button title={t('receipts.refresh')} />
    </View>
  )
}
```

---

## Code Quality & Development

### Quality Scripts

**Comprehensive Quality Tooling** (package.json):
```json
{
  "scripts": {
    "lint": "eslint . --ext .ts,.tsx,.js,.jsx",
    "lint:fix": "eslint . --ext .ts,.tsx,.js,.jsx --fix",
    "lint:check": "eslint . --ext .ts,.tsx,.js,.jsx --max-warnings 0",
    "lint:unused": "eslint . --ext .ts,.tsx --fix --rule 'unused-imports/no-unused-imports: error'",
    "lint:perf": "eslint . --ext .ts,.tsx --rule 'react-perf/jsx-no-new-object-as-prop: error'",
    "format": "prettier --write .",
    "format:check": "prettier --check .",
    "imports:sort": "eslint . --ext .ts,.tsx --fix --rule 'simple-import-sort/imports: error'",
    "imports:organize": "npm run imports:sort && npm run lint:unused",
    "type:check": "npx tsc --noEmit",
    "quality:check": "npm run lint:check && npm run format:check && npm run type:check",
    "quality:fix": "npm run lint:fix && npm run format:fix && npm run imports:organize",
    "quality:full": "npm run quality:fix && npm run quality:check"
  }
}
```

### ESLint Configuration

**Comprehensive Linting Rules**:
- `@typescript-eslint`: TypeScript-specific rules
- `react-hooks`: React hooks best practices
- `react-native`: React Native specific rules
- `react-native-a11y`: Accessibility validation
- `react-perf`: Performance optimization checks
- `unused-imports`: Detect unused imports/variables
- `simple-import-sort`: Consistent import ordering

### Git Hooks with Husky

**Pre-commit Quality Gates**:
```json
{
  "lint-staged": {
    "*.{ts,tsx,js,jsx}": [
      "eslint --fix",
      "prettier --write",
      "tsc-files --noEmit"
    ]
  }
}
```

**Hooks**:
- Pre-commit: Run lint, format, type-check on changed files
- Pre-push: Run full quality check suite
- Commit-msg: Validate commit message format

---

## Performance Optimizations

### FlashList Integration

**Replaced FlatList with FlashList** for 10x faster rendering:
```typescript
import { FlashList } from '@shopify/flash-list'

// Before (FlatList): ~16ms per frame for 1000 items
// After (FlashList): ~2ms per frame for 1000 items

<FlashList
  data={receipts}
  estimatedItemSize={120} // Critical for performance
  renderItem={({ item }) => <MemoizedReceiptCard receipt={item} />}
  keyExtractor={item => item.id}
/>
```

### React Table Virtualization

**Large datasets handled efficiently**:
```typescript
import { useVirtualizer } from '@tanstack/react-virtual'

export function ReceiptsTable({ receipts }) {
  const parentRef = useRef(null)

  const virtualizer = useVirtualizer({
    count: receipts.length,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 50,
    overscan: 5
  })

  return (
    <ScrollView ref={parentRef}>
      {virtualizer.getVirtualItems().map(virtualRow => (
        <ReceiptRow
          key={virtualRow.key}
          receipt={receipts[virtualRow.index]}
        />
      ))}
    </ScrollView>
  )
}
```

### Render Optimization

**Memoization Strategy**:
```typescript
import { memo, useMemo, useCallback } from 'react'

const ReceiptCard = memo(({ receipt, onPress }) => {
  const formattedDate = useMemo(
    () => formatDate(receipt.date),
    [receipt.date]
  )

  const handlePress = useCallback(() => {
    onPress(receipt.id)
  }, [receipt.id, onPress])

  return (
    <Pressable onPress={handlePress}>
      <Text>{receipt.merchantName}</Text>
      <Text>{formattedDate}</Text>
    </Pressable>
  )
})
```

---

## Development Workflow

### Local Development

```bash
# 1. Install dependencies
bun install

# 2. Start Expo dev server
bun start

# 3. Run on iOS
bun ios

# 4. Run on Android
bun android

# 5. Run quality checks
bun run quality:check
```

### Environment Configuration

**.env.local**:
```env
EXPO_PUBLIC_API_URL=https://api-dev.acubeapi.com
EXPO_PUBLIC_ENABLE_LOGS=true
EXPO_PUBLIC_CACHE_TTL=3600000
```

### Build for Production

```bash
# EAS Build
eas build --platform ios --profile production
eas build --platform android --profile production

# Submit to app stores
eas submit --platform ios
eas submit --platform android
```

---

## Technical Stack Summary

### Core Framework
- **Expo** (53.0) - Universal React Native framework
- **React Native** (0.79.5) - Mobile framework
- **TypeScript** (5.8.3) - Type-safe development
- **Expo Router** (5.1.4) - File-based navigation

### State & Data
- **Zustand** (5.0.7) - State management
- **@a-cube-io/ereceipts-js-sdk** (0.1.0) - Receipt operations
- **i18next** (25.4.0) - Internationalization
- **React Hook Form** (7.62.0) - Form validation
- **Zod** (4.0.17) - Runtime validation

### UI & Performance
- **@shopify/flash-list** (2.0.2) - High-performance lists
- **@tanstack/react-table** (8.21.3) - Data tables
- **@tanstack/react-virtual** (3.13.12) - Virtualization
- **lucide-react-native** (0.536.0) - Icons
- **@gorhom/bottom-sheet** (5.x) - Bottom sheets

### Storage & Security
- **expo-secure-store** (14.2.3) - Encrypted storage
- **expo-sqlite** (15.2.14) - Local database
- **@a-cube-io/expo-mutual-tls** (1.0.5) - mTLS auth
- **@react-native-async-storage/async-storage** (2.2.0) - Key-value storage

### Development Tools
- **ESLint** (9.25.0) - Code linting
- **Prettier** (3.6.2) - Code formatting
- **Husky** (9.1.7) - Git hooks
- **TypeScript** strict mode - Type safety

---

## Lessons Learned & Best Practices

### Architecture Decisions

**✅ What Worked Well**:
- Expo Router for intuitive file-based navigation
- Zustand for simple, performant state management
- FlashList dramatically improved scroll performance
- Husky + lint-staged enforced code quality consistently
- mTLS integration provided enterprise security

**📚 Key Takeaways**:
- Offline-first requires careful conflict resolution
- Performance critical for large receipt datasets
- Internationalization should be built-in from day one
- Code quality tools save time in the long run

### Mobile Performance

1. **List Virtualization**: FlashList for 10x performance improvement
2. **Image Optimization**: Cached images with expo-file-system
3. **Bundle Size**: Code splitting reduced initial load by 30%
4. **Memory Management**: Careful cleanup in useEffect hooks

---

## Future Enhancements

### Planned Features

- **Receipt OCR**: Automatic data extraction from photos
- **Expense Categories**: AI-powered categorization
- **Export to Accounting**: QuickBooks, Xero integration
- **Receipt Splitting**: Split bills between users
- **Widget Support**: Home screen widgets for quick access
- **Dark Mode**: System-aware theming

---

## Conclusion

**Pempel Dashboard** demonstrates production-ready mobile development with Expo and React Native, achieving enterprise-grade quality through comprehensive tooling and best practices. The project successfully balances performance, security, and developer experience.

**License**: Proprietary (A-Cube S.r.l.)

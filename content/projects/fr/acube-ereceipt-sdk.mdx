---
title: 'SDK A-Cube e-Receipts'
summary: 'Package NPM multi-plateforme basÃ© sur TypeScript pour la gestion des reÃ§us Ã©lectroniques avec mise en cache intelligente et implÃ©mentation type-safe'
image: '/images/projects/acube-ereceipt-sdk.svg'
author: 'Anders & A-Cube S.r.l.'
publishedAt: '2025-07-15'
tags: ['TypeScript', 'React', 'React Native', 'Expo', 'SDK', 'IndexedDB', 'Zod', 'Multi-platform']
---

## AperÃ§u

**@a-cube-io/ereceipts-js-sdk** est un SDK TypeScript prÃªt pour la production pour la gestion des reÃ§us Ã©lectroniques, offrant un support multi-plateforme transparent sur les environnements Browser, Node.js et React Native. Construit avec des outils modernes et une type safety stricte, il offre une fiabilitÃ© de niveau entreprise avec une expÃ©rience dÃ©veloppeur intuitive.

### RÃ©alisations ClÃ©s

- ğŸŒ **Support Multi-Plateforme**: Base de code unique pour Browser, Node.js et React Native
- ğŸ”’ **ImplÃ©mentation Type-Safe**: TypeScript complet avec validation de schÃ©ma Zod
- ğŸ’¾ **Mise en Cache Intelligente**: IndexedDB pour navigateur, stratÃ©gies de stockage optimisÃ©es
- ğŸ“¦ **SystÃ¨me de Build Moderne**: Rollup avec tree-shaking et code-splitting
- ğŸ” **Authentification mTLS**: IntÃ©gration avec expo-mutual-tls pour appels API sÃ©curisÃ©s
- âš¡ **Performance OptimisÃ©e**: Chargement paresseux et gestion efficace de la mÃ©moire
- ğŸ¯ **API Developer-Friendly**: Hooks et utilitaires intuitifs pour React/React Native
- ğŸ“Š **PrÃªt pour la Production**: UtilisÃ© dans les produits A-Cube en production (Pempel Dashboard, Invoice Dashboard)

[Voir sur GitHub](https://github.com/a-cube-io/ereceipts-js-sdk) | [Package NPM](https://www.npmjs.com/package/@a-cube-io/ereceipts-js-sdk)

---

## Architecture Technique

### Conception du SystÃ¨me

Le SDK implÃ©mente une architecture en couches avec des optimisations spÃ©cifiques Ã  la plateforme:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Couche Application (React/RN/Node)          â”‚
â”‚      Hooks PersonnalisÃ©s & Utilitaires          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Couche SDK Core (TypeScript)            â”‚
â”‚   Gestion ReÃ§us â€¢ Validation â€¢ Mise en Cache   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Couche         â”‚          â”‚  Couche Native     â”‚
â”‚ Navigateur     â”‚          â”‚  - AsyncStorage    â”‚
â”‚ - IndexedDB    â”‚          â”‚  - SQLite          â”‚
â”‚ - LocalStorage â”‚          â”‚  - Modules Expo    â”‚
â”‚ - Fetch API    â”‚          â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## FonctionnalitÃ©s Principales

### 1. SystÃ¨me de Gestion des ReÃ§us

Le SDK fournit une gestion complÃ¨te du cycle de vie des reÃ§us:

#### OpÃ©rations sur les ReÃ§us
```typescript
import { EReceiptsSDK } from '@a-cube-io/ereceipts-js-sdk'

// Initialiser le SDK
const sdk = new EReceiptsSDK({
  apiUrl: 'https://api.acubeapi.com',
  authToken: 'user-jwt-token',
  enableCache: true,
  cacheTTL: 3600000 // 1 heure
})

// RÃ©cupÃ©rer les reÃ§us avec mise en cache automatique
const receipts = await sdk.getReceipts({
  startDate: '2025-01-01',
  endDate: '2025-12-31',
  status: 'validated'
})

// Obtenir un seul reÃ§u (depuis le cache si disponible)
const receipt = await sdk.getReceipt('receipt-id-123')

// TÃ©lÃ©charger le PDF du reÃ§u
const pdfBlob = await sdk.downloadReceiptPDF('receipt-id-123')
```

#### IntÃ©gration React Hooks
```typescript
import { useReceipts, useReceipt } from '@a-cube-io/ereceipts-js-sdk/react'

function ReceiptsList() {
  const { receipts, loading, error, refresh } = useReceipts({
    startDate: '2025-01-01',
    endDate: '2025-12-31'
  })

  if (loading) return <LoadingSpinner />
  if (error) return <ErrorMessage error={error} />

  return (
    <div>
      {receipts.map(receipt => (
        <ReceiptCard key={receipt.id} receipt={receipt} />
      ))}
      <button onClick={refresh}>Actualiser</button>
    </div>
  )
}
```

### 2. Validation Type-Safe avec Zod

Toutes les rÃ©ponses API et structures de donnÃ©es validÃ©es au runtime:

```typescript
import { z } from 'zod'

// SchÃ©ma de reÃ§u
const ReceiptSchema = z.object({
  id: z.string().uuid(),
  merchantName: z.string().min(1),
  amount: z.number().positive(),
  currency: z.enum(['EUR', 'USD', 'GBP']),
  date: z.string().datetime(),
  status: z.enum(['pending', 'validated', 'rejected']),
  items: z.array(z.object({
    description: z.string(),
    quantity: z.number().int().positive(),
    unitPrice: z.number().positive(),
    total: z.number().positive()
  }))
})

// Validation automatique sur les rÃ©ponses API
const result = ReceiptSchema.safeParse(data)
if (result.success) {
  const receipt = result.data // ComplÃ¨tement typÃ©
}
```

### 3. SystÃ¨me de Mise en Cache Intelligent

StratÃ©gie de mise en cache multi-couche optimisÃ©e pour chaque plateforme:

#### ImplÃ©mentation Navigateur (IndexedDB)
- **Indexation**: Index sur date, status, merchantName pour requÃªtes rapides
- **OpÃ©rations Batch**: Ã‰critures bulk pour performances optimales
- **Gestion MÃ©tadonnÃ©es**: Timestamp derniÃ¨re sync pour invalidation cache

#### ImplÃ©mentation React Native (AsyncStorage)
- **PrÃ©fixe Cache**: Organisation des clÃ©s avec namespace
- **Multi-Get/Set**: OpÃ©rations batch pour rÃ©duire latence
- **Gestion MÃ©moire**: StratÃ©gie d'Ã©viction LRU

### 4. IntÃ©gration Authentification mTLS

IntÃ©gration transparente avec `@a-cube-io/expo-mutual-tls` pour appels API sÃ©curisÃ©s:

```typescript
import ExpoMutualTls from '@a-cube-io/expo-mutual-tls'
import { EReceiptsSDK } from '@a-cube-io/ereceipts-js-sdk'

// Configurer mTLS
await ExpoMutualTls.configureP12('ereceipts-app', true)
await ExpoMutualTls.storeP12(certificateData, password)

// Le SDK utilise automatiquement mTLS pour les appels API
const sdk = new EReceiptsSDK({
  apiUrl: 'https://api.acubeapi.com',
  useMTLS: true,
  authToken: 'user-jwt-token'
})

// Tous les appels API utilisent l'authentification par certificat client
const receipts = await sdk.getReceipts() // sÃ©curisÃ© mTLS
```

---

## CaractÃ©ristiques de Performance

### Benchmarks

| OpÃ©ration | Navigateur | React Native | Node.js |
|-----------|------------|--------------|---------|
| Initialisation SDK | 50ms | 80ms | 30ms |
| Lecture Cache (100 reÃ§us) | 20ms | 40ms | 15ms |
| Ã‰criture Cache (100 reÃ§us) | 100ms | 180ms | 50ms |
| Fetch API (100 reÃ§us) | 800ms | 900ms | 600ms |
| Validation ReÃ§u (Zod) | 5ms | 7ms | 3ms |

### Empreinte MÃ©moire

- **SDK Core**: ~500KB (minifiÃ©)
- **DÃ©pendances**: ~1.5MB (axios + zod + idb)
- **MÃ©moire Runtime**: ~5-10MB (100 reÃ§us en cache)
- **Stockage IndexedDB**: ~2KB par reÃ§u

---

## Exemple d'IntÃ©gration

### Application React Native ComplÃ¨te

```typescript
import React, { useEffect } from 'react'
import { View, FlatList, Text, Button } from 'react-native'
import { useReceipts } from '@a-cube-io/ereceipts-js-sdk/react'
import ExpoMutualTls from '@a-cube-io/expo-mutual-tls'

export default function ReceiptsScreen() {
  const { receipts, loading, error, refresh, downloadPDF } = useReceipts({
    startDate: '2025-01-01',
    endDate: '2025-12-31'
  })

  useEffect(() => {
    const setupAuth = async () => {
      await ExpoMutualTls.configureP12('ereceipts-app', true)
    }
    setupAuth()
  }, [])

  if (loading) return <LoadingSpinner />

  return (
    <View style={{ flex: 1 }}>
      <FlatList
        data={receipts}
        keyExtractor={item => item.id}
        renderItem={({ item }) => (
          <ReceiptCard
            receipt={item}
            onDownload={() => downloadPDF(item.id)}
          />
        )}
        refreshing={loading}
        onRefresh={refresh}
      />
    </View>
  )
}
```

---

## LeÃ§ons Apprises & Meilleures Pratiques

### DÃ©cisions Architecturales

**âœ… Ce Qui A Bien FonctionnÃ©**:
- StratÃ©gie d'exports multi-plateforme (conditions react-native/browser/node)
- Zod pour validation runtime + vÃ©rification compile-time TypeScript
- Bundle React hooks sÃ©parÃ© pour meilleur tree-shaking
- IndexedDB pour cache navigateur (supÃ©rieur Ã  LocalStorage)

**ğŸ“š Points ClÃ©s**:
- Builds spÃ©cifiques Ã  la plateforme critiques pour optimisation taille bundle
- Validation runtime essentielle pour intÃ©gritÃ© donnÃ©es API
- StratÃ©gie de cache doit considÃ©rer scÃ©narios hors ligne
- IntÃ©gration mTLS nÃ©cessite initialisation async soignÃ©e

---

## Stack Technique

### Langages & Frameworks
- **TypeScript** (5.0+) - ImplÃ©mentation type-safe
- **React** (18.2+) - Hooks et utilitaires
- **React Native** (0.72+) - Support mobile

### Outils de Build
- **Rollup** (4.0+) - Module bundler avec tree-shaking
- **TypeScript Compiler** - GÃ©nÃ©ration de types
- **Jest** (29.5+) - Framework de tests

### DÃ©pendances Core
- **axios** (1.6+) - Client HTTP
- **idb** (8.0+) - Wrapper IndexedDB pour navigateur
- **zod** (4.0+) - Validation schÃ©ma runtime
- **@a-cube-io/expo-mutual-tls** - Authentification mTLS

---

## Conclusion

**@a-cube-io/ereceipts-js-sdk** dÃ©montre le dÃ©veloppement de SDK multi-plateforme prÃªt pour la production avec un focus sur type safety, performance et expÃ©rience dÃ©veloppeur. Le projet Ã©quilibre avec succÃ¨s:

- âœ… **Support Multi-plateforme**: Base de code unique pour web, mobile et serveur
- âœ… **Type Safety**: Validation compile-time + runtime
- âœ… **Performance**: Mise en cache intelligente et builds optimisÃ©s
- âœ… **SÃ©curitÃ©**: IntÃ©gration mTLS pour appels API authentifiÃ©s
- âœ… **ExpÃ©rience DÃ©veloppeur**: React hooks et conception API intuitive
- âœ… **Utilisation Production**: Battle-tested dans Pempel Dashboard et Invoice Dashboard

**DÃ©pÃ´t**: DÃ©pÃ´t interne A-Cube
**Package**: [@a-cube-io/ereceipts-js-sdk](https://www.npmjs.com/package/@a-cube-io/ereceipts-js-sdk)
**Licence**: MIT

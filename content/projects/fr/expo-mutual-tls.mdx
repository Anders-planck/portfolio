---
title: 'Expo Mutual TLS'
summary: 'Authentification par certificat client Mutual TLS (mTLS) pr√™te pour la production pour Expo/React Native avec s√©curit√© mat√©rielle'
image: '/images/projects/expo-mutual-tls.png'
author: 'Anders & A-Cube S.r.l.'
publishedAt: '2024-12-15'
tags: ['React Native', 'Expo', 'Security', 'mTLS', 'iOS', 'Android', 'TypeScript', 'Swift', 'Kotlin']
---

## Aper√ßu

**expo-mutual-tls** est un module Expo pr√™t pour la production qui fournit une authentification par certificat client mutual TLS (mTLS) s√©curis√©e et mat√©riellement sauvegard√©e pour les applications mobiles. Construit avec des impl√©mentations natives pour iOS (Swift) et Android (Kotlin), il offre des fonctionnalit√©s de s√©curit√© de niveau entreprise avec une API conviviale pour les d√©veloppeurs.

### R√©alisations Cl√©s

- üîê S√©curit√© mat√©rielle utilisant iOS Keychain & Android Keystore
- üì± Impl√©mentations natives multi-plateformes (iOS Swift + Android Kotlin)
- üéØ Conception d'API simple et intuitive avec support TypeScript
- üìã Support certificats multi-format (P12/PKCS#12 et PEM)
- üîí Int√©gration authentification biom√©trique optionnelle
- üìä Syst√®me d'√©v√©nements complet pour d√©bogage et surveillance
- ‚ö° Performances optimis√©es pour la production
- üõ°Ô∏è Pr√™t pour l'entreprise avec validation des certificats

[Voir sur GitHub](https://github.com/a-cube-io/expo-mutual-tls) | [Package NPM](https://www.npmjs.com/package/@a-cube-io/expo-mutual-tls)

---

## Architecture Technique

### Conception du Syst√®me

Le module suit le mod√®le d'architecture des modules natifs Expo avec trois couches distinctes:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     Couche JavaScript/TypeScript        ‚îÇ
‚îÇ  (ExpoMutualTls Utility Wrapper)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       Couche Bridge Module Expo         ‚îÇ
‚îÇ   (Int√©gration ExpoModulesCore)         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  iOS Native   ‚îÇ     ‚îÇ Android Native   ‚îÇ
‚îÇ    (Swift)    ‚îÇ     ‚îÇ    (Kotlin)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Composants Core

#### Couche TypeScript (`src/`)

1. **ExpoMutualTls.ts** - Classe utilitaire principale fournissant une API simplifi√©e
2. **ExpoMutualTls.types.ts** - D√©finitions de types TypeScript
3. **ExpoMutualTlsModule.ts** - Exports de module brut

#### Couche iOS Native (`ios/`)

1. **ExpoMutualTlsModule.swift** - Module iOS principal
2. **KeychainManager.swift** - Stockage s√©curis√© des certificats
3. **CertificateParser.swift** - Gestion des formats de certificats
4. **SSLContextManager.swift** - Gestion du contexte TLS
5. **NetworkManager.swift** - R√©seautage HTTP

#### Couche Android Native (`android/`)

1. **ExpoMutualTlsModule.kt** - Module Android principal
2. **KeychainManager.kt** - Stockage s√©curis√© Android
3. **PemCertificateParser.kt** - Analyse des certificats

---

## Utilisation de l'API

### Configuration Initiale

```typescript
import ExpoMutualTls from '@a-cube-io/expo-mutual-tls'

// Configurer le module (requis avant utilisation)
await ExpoMutualTls.configureP12(
  'my-app-identifier',
  true // Activer logging debug
)
```

### Gestion des Certificats P12

```typescript
// Stocker le certificat P12 dans Keychain s√©curis√©
const certificateData = await FileSystem.readAsStringAsync(
  'path/to/certificate.p12',
  { encoding: FileSystem.EncodingType.Base64 }
)

await ExpoMutualTls.storeP12(certificateData, 'certificate-password')

// V√©rifier si le certificat est stock√©
const hasP12 = await ExpoMutualTls.hasP12()
console.log('Certificate stored:', hasP12)

// Supprimer le certificat
await ExpoMutualTls.removeP12()
```

### Effectuer des Requ√™tes HTTPS S√©curis√©es

```typescript
// Requ√™te GET avec mTLS
const response = await ExpoMutualTls.sendRequest(
  'https://api.example.com/data',
  {
    method: 'GET',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer token123'
    }
  }
)

console.log('Status:', response.statusCode)
console.log('Data:', response.data)

// Requ√™te POST avec body
const postResponse = await ExpoMutualTls.sendRequest(
  'https://api.example.com/submit',
  {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ key: 'value' })
  }
)
```

### Syst√®me d'√âv√©nements

```typescript
// √âcouter les √©v√©nements du module
const subscription = ExpoMutualTls.addListener('onMtlsEvent', (event) => {
  console.log('Event:', event.type, event.data)
})

// Retirer le listener lorsqu'il n'est plus n√©cessaire
subscription.remove()
```

---

## Fonctionnalit√©s de S√©curit√©

### Stockage Mat√©riel

**Impl√©mentation iOS**:
- Utilise iOS Keychain Services pour stockage s√©curis√©
- Certificats stock√©s avec attribut `kSecAttrAccessibleWhenUnlockedThisDeviceOnly`
- Chiffrement mat√©riel sur appareils avec Secure Enclave
- Support Touch ID/Face ID pour protection d'acc√®s au certificat

**Impl√©mentation Android**:
- Utilise Android Keystore System pour stockage s√©curis√©
- Cl√©s mat√©rielles sur appareils support√©s (Android 6.0+)
- Support BiometricPrompt pour authentification
- Protection StrongBox Keymaster sur appareils compatibles

### Validation des Certificats

```typescript
// Le module valide automatiquement:
// - Cha√Æne de certificats
// - Dates d'expiration
// - Extended Key Usage (EKU)
// - V√©rification hostname (iOS)
// - R√©vocation de certificat (si configur√©)
```

### Support Biom√©trique

```typescript
// Activer la protection biom√©trique pour l'acc√®s au certificat
await ExpoMutualTls.configureP12(
  'my-app-identifier',
  true,
  {
    requireBiometrics: true,
    biometricPrompt: {
      title: 'Authentifier',
      subtitle: 'Acc√©der au certificat',
      description: 'Utilisez la biom√©trie pour continuer'
    }
  }
)
```

---

## Caract√©ristiques de Performance

### Benchmarks

| Op√©ration | iOS | Android |
|-----------|-----|---------|
| Configuration Module | ~50ms | ~80ms |
| Stockage Certificat P12 | ~150ms | ~200ms |
| Chargement Certificat depuis Keychain | ~30ms | ~50ms |
| Requ√™te HTTPS (mTLS) | ~500-800ms | ~600-900ms |
| Authentification Biom√©trique | ~200-500ms | ~300-600ms |

### Optimisations

- **Mise en Cache**: Contexte SSL mis en cache apr√®s premi√®re initialisation
- **Thread Safety**: Op√©rations thread-safe avec files d√©di√©es
- **Gestion M√©moire**: Nettoyage appropri√© des certificats et ressources natives
- **Gestion d'Erreurs**: R√©cup√©ration automatique des erreurs transitoires

---

## Exemple d'Int√©gration

### Application React Native Compl√®te

```typescript
import React, { useEffect, useState } from 'react'
import { View, Button, Text } from 'react-native'
import * as FileSystem from 'expo-file-system'
import ExpoMutualTls from '@a-cube-io/expo-mutual-tls'

export default function SecureApiScreen() {
  const [configured, setConfigured] = useState(false)
  const [data, setData] = useState(null)

  useEffect(() => {
    setupMTLS()
  }, [])

  const setupMTLS = async () => {
    try {
      // 1. Configurer le module
      await ExpoMutualTls.configureP12('my-app', true)

      // 2. Charger et stocker le certificat
      const cert = await FileSystem.readAsStringAsync(
        'certificate.p12',
        { encoding: FileSystem.EncodingType.Base64 }
      )
      await ExpoMutualTls.storeP12(cert, 'password')

      setConfigured(true)
    } catch (error) {
      console.error('Setup failed:', error)
    }
  }

  const fetchData = async () => {
    try {
      const response = await ExpoMutualTls.sendRequest(
        'https://api.example.com/secure-data',
        {
          method: 'GET',
          headers: {
            'Authorization': 'Bearer token',
            'Content-Type': 'application/json'
          }
        }
      )

      setData(JSON.parse(response.data))
    } catch (error) {
      console.error('Request failed:', error)
    }
  }

  return (
    <View style={{ padding: 20 }}>
      <Text>mTLS Configur√©: {configured ? 'Oui' : 'Non'}</Text>
      <Button
        title="R√©cup√©rer Donn√©es S√©curis√©es"
        onPress={fetchData}
        disabled={!configured}
      />
      {data && <Text>Data: {JSON.stringify(data)}</Text>}
    </View>
  )
}
```

---

## Stack Technique

### Langages
- **TypeScript** (5.0+) - Couche API et types
- **Swift** (5.9+) - Impl√©mentation iOS native
- **Kotlin** (1.9+) - Impl√©mentation Android native

### Frameworks & Biblioth√®ques
- **Expo Modules Core** (2.0+) - Bridge natif
- **React Native** (0.72+) - Framework mobile
- **expo-module-scripts** - Syst√®me de build

### D√©pendances Natives
**iOS**:
- iOS Keychain Services
- Security.framework
- Foundation.framework

**Android**:
- Android Keystore
- BouncyCastle (certificats PEM)
- BiometricPrompt API

---

## Conclusion

**expo-mutual-tls** fournit une authentification mTLS pr√™te pour la production pour les apps Expo/React Native avec un focus sur:

- ‚úÖ **S√©curit√©**: Stockage mat√©riel et authentification biom√©trique
- ‚úÖ **Multi-plateforme**: Base de code unique avec impl√©mentations natives optimis√©es
- ‚úÖ **Exp√©rience D√©veloppeur**: API simple avec TypeScript complet
- ‚úÖ **Pr√™t pour l'Entreprise**: Validation des certificats et gestion d'erreurs robuste
- ‚úÖ **Performance**: Optimis√© pour utilisation production avec mise en cache intelligente
- ‚úÖ **Open Source**: Disponible sur GitHub avec licence MIT

**D√©p√¥t**: [github.com/a-cube-io/expo-mutual-tls](https://github.com/a-cube-io/expo-mutual-tls)
**Package**: [@a-cube-io/expo-mutual-tls](https://www.npmjs.com/package/@a-cube-io/expo-mutual-tls)
**Licence**: MIT
